<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test via Photo 2</title>
</head>
<body>
    <h1>Test de Géolocalisation via Photo</h1>
    <p>Clique sur le bouton pour envoyer ta position :</p>
    <button id="sendPosition">Envoyer ma position</button>

    <script>
        document.getElementById('sendPosition').addEventListener('click', function () {
            if (navigator.geolocation) {
                console.log("Demande de géolocalisation...");
                navigator.geolocation.getCurrentPosition(function (position) {
                    console.log("Position obtenue !");
                    var latitude = position.coords.latitude;
                    var longitude = position.coords.longitude;

                    console.log("Latitude: " + latitude + ", Longitude: " + longitude);

                    var xhr = new XMLHttpRequest();
                    xhr.open("POST", "photo.php", true);
                    xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

                    xhr.onreadystatechange = function () {
                        if (xhr.readyState === 4) {
                            if (xhr.status === 200) {
                                try {
                                    var response = JSON.parse(xhr.responseText);
                                    console.log("Réponse du serveur : ", response);
                                    if (response.status === 'success') {
                                        alert("Position enregistrée avec succès : " + response.message);
                                    } else {
                                        alert("Erreur : " + response.message);
                                    }
                                } catch (e) {
                                    console.error("Erreur lors du parsing de la réponse JSON : ", e);
                                    console.log("Réponse brute : " + xhr.responseText);
                                }
                            } else {
                                alert("Erreur HTTP : " + xhr.status);
                            }
                        }
                    };

                    console.log("Envoi de la position...");
                    xhr.send("latitude=" + latitude + "&longitude=" + longitude);
                }, function (error) {
                    console.error("Erreur lors de la géolocalisation : ", error);
                });
            } else {
                alert("La géolocalisation n'est pas supportée par ce navigateur.");
            }
        });
    </script>
</body>
</html>
